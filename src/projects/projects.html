<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Projects - Wegweiser</title>
  <link rel="stylesheet" href="projects.css">
</head>
<body>
  <!-- Projects List View -->
  <div id="projects-list-view" class="view active">
    <header class="header">
      <h1>Projects</h1>
      <div class="header-actions">
        <button id="create-project-btn" class="btn btn-primary">+ Create Project</button>
        <button id="projects-settings-btn" class="btn-icon" title="Open settings" aria-label="Open settings">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
          </svg>
        </button>
      </div>
    </header>

    <main class="projects-grid" id="projects-grid">
      <!-- Project cards will be inserted here -->
    </main>

    <div id="empty-state" class="empty-state" style="display: none;">
      <div class="empty-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="64" height="64">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
          <path d="M12 7h-2v4H6v2h4v4h2v-4h4v-2h-4z"/>
        </svg>
      </div>
      <h2>Create your first Project</h2>
      <p>Organize conversations by project or topic</p>
      <button class="btn btn-primary" id="empty-create-btn">+ Create Project</button>
    </div>

    <footer class="storage-footer" id="storage-footer">
      <div class="storage-meters">
        <div class="storage-meter">
          <div class="storage-label">IndexedDB Storage</div>
          <div class="storage-bar storage-bar-secondary">
            <div class="storage-fill storage-fill-secondary" id="storage-fill-images"></div>
          </div>
          <span class="storage-text" id="storage-text-images">Loading IndexedDB storage...</span>
        </div>
      </div>
    </footer>
  </div>

  <!-- Project View (two-panel) -->
  <div id="project-view" class="view">
    <header class="project-header">
      <button id="back-btn" class="btn-icon" title="Back to Projects">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
          <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
      </button>
      <h2 id="project-title">Project Name</h2>
      <button id="project-settings-btn" class="btn-icon" title="Project Settings">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
          <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
        </svg>
      </button>
    </header>

    <div class="project-content">
      <!-- Thread List Panel -->
      <aside class="thread-panel">
        <button id="new-thread-btn" class="btn btn-secondary btn-full">+ New Thread</button>
        <div class="thread-list" id="thread-list">
          <!-- Thread items will be inserted here -->
        </div>
      </aside>

      <!-- Chat Panel -->
      <main class="chat-panel">
        <div id="chat-empty-state" class="chat-empty">
          <p>Select a thread or start a new one to begin chatting</p>
        </div>

        <div id="chat-container" class="chat-container" style="display: none;">
          <div class="chat-messages" id="chat-messages">
            <!-- Messages will be inserted here -->
          </div>

          <div class="chat-input-wrapper">
            <div class="chat-toggles">
              <div class="chat-toggles-left">
                <label class="chat-toggle">
                  <input type="checkbox" id="chat-web-search">
                  <span class="chat-toggle-switch"></span>
                  <span class="chat-toggle-text">Web Search</span>
                </label>
                <label class="chat-toggle">
                  <input type="checkbox" id="chat-reasoning">
                  <span class="chat-toggle-switch"></span>
                  <span class="chat-toggle-text">Reasoning</span>
                </label>
                <label class="chat-toggle">
                  <input type="checkbox" id="chat-image-mode">
                  <span class="chat-toggle-switch"></span>
                  <span class="chat-toggle-text">Image</span>
                </label>
              </div>
              <button id="projects-context-btn" class="projects-context-btn" type="button" aria-label="View conversation context" aria-disabled="true">
                <span class="projects-context-icon">üß†</span>
                <span class="projects-context-badge" style="display: none;"></span>
              </button>
            </div>
            <div class="chat-input-container" id="chat-input-container">
              <div class="chat-input-field">
                <textarea id="chat-input" placeholder="Type a message..." rows="1"></textarea>
                <button id="stop-btn" class="stop-inline-btn" style="display: none;" aria-label="Stop generation" aria-hidden="true">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" aria-hidden="true">
                    <rect x="6" y="6" width="12" height="12" rx="2" ry="2" fill="currentColor"></rect>
                  </svg>
                </button>
              </div>
              <button id="send-btn" class="btn btn-primary">Send</button>
            </div>
            <div class="chat-meta-row">
              <div id="chat-model-indicator" class="chat-model-indicator"></div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Create/Edit Project Modal -->
  <div id="project-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">Create Project</h3>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <form id="project-form">
        <div class="icon-picker-group">
          <label class="icon-picker-label">Icon</label>
          <div class="icon-picker-wrapper">
            <div class="icon-picker-container">
              <div class="icon-preview" id="icon-preview" title="Click to change icon">üìÅ</div>
              <span class="text-muted">Click to choose an emoji</span>
            </div>
            <div class="emoji-grid" id="emoji-grid">
              <div class="emoji-grid-inner" id="emoji-grid-inner">
                <!-- Emojis will be inserted by JS -->
              </div>
            </div>
          </div>
          <input type="hidden" id="project-icon" value="üìÅ">
        </div>
        <div class="form-group">
          <label for="project-name">Name *</label>
          <input type="text" id="project-name" required placeholder="e.g., Project Research">
        </div>
        <div class="form-group">
          <label for="project-description">Description</label>
          <input type="text" id="project-description" placeholder="Optional description">
        </div>
        <div class="form-group">
          <label for="project-model">Model</label>
          <div style="position: relative;">
            <input type="text" id="project-model-input" placeholder="Type to search models..." />
            <select id="project-model" style="display: none;"></select>
          </div>
        </div>
        <div class="form-group">
          <label for="project-instructions">Custom Instructions</label>
          <textarea id="project-instructions" rows="3" placeholder="Optional instructions for AI responses in this Project"></textarea>
        </div>
        <div class="form-group-row">
          <div class="toggle-group">
            <label class="toggle-label">
              <input type="checkbox" id="project-web-search">
              <span class="toggle-switch"></span>
              <span class="toggle-text">Web Search</span>
            </label>
          </div>
          <div class="toggle-group">
            <label class="toggle-label">
              <input type="checkbox" id="project-reasoning">
              <span class="toggle-switch"></span>
              <span class="toggle-text">Reasoning</span>
            </label>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="modal-cancel">Cancel</button>
          <button type="submit" class="btn btn-primary" id="modal-save">Create Project</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Rename Thread Modal -->
  <div id="rename-modal" class="modal" style="display: none;">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h3>Rename Thread</h3>
        <button class="modal-close" id="rename-modal-close">&times;</button>
      </div>
      <form id="rename-form">
        <div class="form-group">
          <label for="thread-title">Title</label>
          <input type="text" id="thread-title" required>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="rename-cancel">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal" style="display: none;">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h3 id="delete-title">Delete Project</h3>
        <button class="modal-close" id="delete-modal-close">&times;</button>
      </div>
      <p id="delete-message">Are you sure you want to delete this Project and all its threads?</p>
      <p id="delete-size" class="text-muted"></p>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" id="delete-cancel">Cancel</button>
        <button type="button" class="btn btn-danger" id="delete-confirm">Delete</button>
      </div>
    </div>
  </div>

  <!-- Storage Warning Banner -->
  <div id="storage-warning" class="storage-warning" style="display: none;">
    <span id="warning-message"></span>
    <button id="warning-close" class="warning-close">&times;</button>
  </div>

  <script src="../lib/purify.min.js"></script>
  <script src="../modules/safe-html.js"></script>
  <script src="../modules/toast.js"></script>
  <script src="../modules/markdown.js"></script>
  <script src="../modules/sources.js"></script>
  <script src="../modules/source-cards.js"></script>
  <script src="../modules/image-cards.js"></script>
  <script src="../modules/exporter.js"></script>
  <script src="../modules/theme.js"></script>
  <script src="../shared/utils.js"></script>
  <script src="../shared/crypto-store.js"></script>
  <script src="../shared/encrypted-storage.js"></script>
  <script src="../shared/chat-store.js"></script>
  <script src="../shared/image-store.js"></script>
  <script src="../shared/image-cache.js"></script>
  <script src="../modules/provider-ui-utils.js"></script>
  <script src="../modules/models-dropdown.js"></script>
  <script src="../modules/streaming-ui.js"></script>
  <script src="projects-basic-utils.js"></script>
  <script src="projects-image-utils.js"></script>
  <script src="projects-thread-list-utils.js"></script>
  <script src="projects-cards-utils.js"></script>
  <script src="projects-export-utils.js"></script>
  <script src="projects-storage-utils.js"></script>
  <script src="projects-storage-view-utils.js"></script>
  <script src="projects-data-utils.js"></script>
  <script src="projects-view-utils.js"></script>
  <script src="projects-thread-view-utils.js"></script>
  <script src="projects-click-actions-utils.js"></script>
  <script src="projects-archive-view-utils.js"></script>
  <script src="projects-chat-view-utils.js"></script>
  <script src="projects-chat-click-utils.js"></script>
  <script src="projects-message-render-utils.js"></script>
  <script src="projects-message-postprocess-utils.js"></script>
  <script src="projects-elements-utils.js"></script>
  <script src="projects-emoji-utils.js"></script>
  <script src="projects-delete-modal-utils.js"></script>
  <script src="projects-project-modal-utils.js"></script>
  <script src="projects-chat-settings-utils.js"></script>
  <script src="projects-chat-panel-utils.js"></script>
  <script src="projects-storage-warning-utils.js"></script>
  <script src="projects-form-utils.js"></script>
  <script src="projects-menu-utils.js"></script>
  <script src="projects-export-menu-utils.js"></script>
  <script src="projects-modal-ui-utils.js"></script>
  <script src="projects-sources-summary-utils.js"></script>
  <script src="projects-context.js"></script>
  <script src="projects-stream-utils.js"></script>
  <script src="projects-stream-runtime-utils.js"></script>
  <script src="projects-stream-request-utils.js"></script>
  <script src="projects-stream-chunk-utils.js"></script>
  <script src="projects-message-flow-utils.js"></script>
  <script src="projects-summarization-flow-utils.js"></script>
  <script src="projects-storage-controller-utils.js"></script>
  <script src="projects-modal-controller-utils.js"></script>
  <script src="projects-events-controller-utils.js"></script>
  <script src="projects-send-controller-utils.js"></script>
  <script src="projects.js"></script>
</body>
</html>



