# Context Save: Wegweiser Reorganization

**Session Date:** 2026-01-14
**Project:** Wegweiser Chrome Extension
**Version:** 0.9.0

---

## Session Summary

Successfully reorganized the Chrome extension codebase from a flat file structure to a modular `src/` directory structure.

---

## Architectural Changes Made

### New Directory Structure
```
openrouter-sidepanel-ext/
├── src/
│   ├── background/
│   │   └── background.js           # Service worker
│   ├── sidepanel/
│   │   ├── sidepanel.html
│   │   ├── sidepanel.css
│   │   └── sidepanel.js
│   ├── options/
│   │   ├── options.html
│   │   └── options.js
│   ├── modules/
│   │   ├── toast.js
│   │   ├── markdown.js
│   │   ├── sources.js
│   │   ├── theme.js
│   │   ├── models-dropdown.js
│   │   └── context-viz.js
│   └── shared/
│       ├── constants.js
│       └── utils.js
├── docs/
│   ├── features/
│   └── releases/
├── icons/
├── tests/
├── manifest.json
├── README.md
└── CLAUDE.md
```

### Files Moved
- `background.js` → `src/background/`
- `constants.js`, `utils.js` → `src/shared/`
- `sidepanel.html`, `sidepanel.css`, `sidepanel.js` → `src/sidepanel/`
- `options.html`, `options.js` → `src/options/`
- `toast.js`, `markdown.js`, `sources.js`, `theme.js`, `models-dropdown.js`, `context-viz.js` → `src/modules/`
- 12 documentation `.md` files → `docs/`

### Path Updates Required
1. **manifest.json** - Updated service_worker, side_panel, and options_ui paths
2. **sidepanel.html** - Script tags updated to `../modules/` and `../shared/` paths
3. **options.html** - Script tags updated similarly

---

## Critical Discovery: Service Worker Import Paths

**Problem:** Chrome extension service workers with `"type": "module"` don't resolve relative import paths correctly.

**Solution:** Use absolute paths from extension root:
```javascript
// WRONG - relative path fails
import { ... } from '../shared/constants.js';

// CORRECT - absolute path from extension root
import { ... } from '/src/shared/constants.js';
```

This quirk is now documented in CLAUDE.md.

---

## Files Modified

| File | Changes |
|------|---------|
| `manifest.json` | Updated paths to src/ subdirectories |
| `src/sidepanel/sidepanel.html` | Updated script src paths |
| `src/options/options.html` | Updated script src paths |
| `src/background/background.js` | Import path changed to absolute |
| `CLAUDE.md` | Added directory structure, updated all file references, documented import quirk |

---

## Decisions & Rationale

1. **Chose buildless approach** - Extension can be loaded directly without bundler, keeping development simple
2. **Organized by feature** - sidepanel/, options/, background/ for clear separation
3. **Shared modules** - constants.js and utils.js in shared/ for cross-component use
4. **UI modules in modules/** - Reusable UI components like toast, markdown, theme
5. **Documentation in docs/** - Keeps root clean, organized by type (features/, releases/)

---

## Tags
`#chrome-extension` `#refactoring` `#file-organization` `#manifest-v3` `#es-modules`

